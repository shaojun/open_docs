# 云端

1. 提供 `litefcccore app` 和 `elenet app` 或者其它app 的文件包的人工  _上传_ / _下载_ / _删除_  功能页面

    允许上传的文件包为zip格式。    
    每个app包上传时，还应指定此app包的一些额外信息以增强此watchdog程序的通用性，以后加入新的app时均可以直接支持：    
    * 对应的板子上的本地的更新路径    
    * 对应的service name    

    > 当前仅支持每个app上传一个文件包

2. 提供查看当前已经上传的app包，以及包的版本号功能页面。   
3. 可针单个app上传 _控制文件_     
   _控制文件_ 中的内容可用于额外的控制功能，控制功能包括：
    * 允许下载新版本app包的`板子id`列表    
        每块板子都有一个唯一id，只有板子的id在此列表中时，板子才进行新app包的下载。    
        此功能等同于灰度升级，即支持部分板子下载升级，等观察稳定后，再全面放开升级。    
        支持通配符`*`，它代表匹配所有板子。
    * 允许定义新app包`下载完成`后，本地重启对应app(以起效新版本)的时间    
        可以是每天的某个固定时间，也可以是从下载完成后多少分钟后重启 。
    * 允许定义某app的定时重启时间    
        app可能存在需要定期重启的需求，此处应可定义该时间，应是每天的某个固定时间。
    * 允许定义板子的重启时间    
        板子运行一段时间可能有要定期重启的需求，此处应可定义该时间。    
        可以是每天的某个固定时间（如每天凌晨2：00），也可以是每周的某几天的某个固定时间（如每周一、三、五的凌晨3：00）。
4. 开放`查询 web api`接口    
    * 供板子端下载app包、控制文件相关功能。    
        如果当前有`>=5 `(可配置)个板子端正在下载app包，则可拒绝后续的下载请求，直到数量`<5`(可配置). 
5. 开放`通知 web api`接口    
    以供板子端主动调用并传入信息，包括板子最近一次查询时间(可用于了解板子侧是否在线）、下载新包完成、重启新下载包完成、定期重启完成的通知，并提供列表以供查看。   

# 板子端
应新建立一个`watch dog service`，以与云端相关接口配合行使功能
1. 查询和下载云端更新包信息    
    以某时间间隔（默认1分钟，并可配置）去云端分别检查`各app` 是否存在更新包，如果存在且版本号大于本地版本号，则开始下载至本地临时文件夹（注意，可能因网络或者server busy被拒绝），并同时下载 _控制文件_。
2. 应用新app    
    如果有 _控制文件_ ，则解析并依规则执行，否则默认于午夜1：00重启对应的被更新过的app.

3. 应用其它规则    
    如定时重启任务。         

4. 调用云端`通知 web api`接口    
    各重要事件，都需要调用云端相关通知接口。