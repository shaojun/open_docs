# Edge
## 远程连接
### 现状
目前边缘采用长连接`frp client`到`frp server`, 每台边缘使用了`3个(?)`端口, 随着量上升, 很快端口不够用, 同时`frp server`也出现连接**数爆**.

### 方案
采用`按需动态创建frp连接`的办法:
1. 在`web`上点击某台电梯的`开启远程连接`
2. 从web后端发送kafka message消息(随机的 ssh port number, camera administration port number, litefcccore web console port number and etc.)至目标边缘.
3. 边缘收取web后端发来的消息后, 启动`frp client`并打开指定端口.
4. 管理人员可以远程管理边缘了.
5. web后端上点击关闭,或者30分钟后自动关闭.
### 工作量
边缘 - 1天
web后端:
* 一阶段 putty - **1天**
* 二阶段 web ssh - **1天**
## kafka消息
### 现状
有两个程序在使用`kafka`消息,分别是`elenet`即`图像识别程序`, 以及 `litefcccore` 即`传感器控制程序`, 两者上传消息流量很大.
### 方案
* 移除不必要的消息
* 降低消息频次
* 减少消息长度
### 工作量
* **2天**

## 连接多kafka服务器以实现负载均衡
### 现状
使用 `msg.glfiot.com 9092`作为默认kafka server发送消息,如果边缘数量上升, 单一的kafka server将无法负担.
### 方案
将所有边缘分批次,以连接不同的kafka server.
采用动态配置下载
### 工作量
* 广泛的参数配置下载 - **3天**

## 自动诊断
### 现状
很多问题需要人工remote ssh上去查看
边缘配置页面只能本地配置
### 方案
* 自动定时上传信息system and sensors 数据至云端,以供健康度分析???
* 边缘配置页面也支持远程访问进行配置

  
# DeviceHub
## 多服务器的负载均衡
### 现状
采用多进程负载均衡,即每个进程负责一批边缘的消息,如果边缘数量上升,单一机器无法负担.
每进程 140台.
### 方案
允许多台机器部署 DeviceHub 进程

### 工作量
* 在边缘数量<=5000台时
需要25个核心进程,采用多CPU核心的服务2台? **2天**

* 在边缘数量5000至10000台时 
需要更多核心进程,采用多CPU核心的服务2台? **5天**

  每台机器应有这样的配置, 8核心CPU, 16G内存,xxxxxxxxxx, 则每添加一台可以扩容支持xxxx台边缘.
* 在边缘数量>10000台 and < 50000台时
需要更多核心进程,采用多CPU核心的服务2台? **?????**
  
## 连接多kafka服务器以实现负载均衡
### 现状
使用 `msg.glfiot.com 9092`作为默认kafka server发送消息,如果边缘数量上升, 单一的kafka server将无法负担.
### 方案
将所有dh分批次,以连接不同的kafka server.
### 工作量

# kafka broker
## 多服务器的负载均衡
### 现状
单服务器上部署了3 cluster集群, with promethues + grafana + node exporter 监控.
### 方案
允许多台机器部署

### 计划
* 在边缘数量<=5000台时
  需要3台Kafka服务器  **2天**
* 在边缘数量5000至10000台时
  需要6台Kafka服务器  **3天**
  或者上阿里云的kafka平台 **2天**
* 在边缘数量>10000台
  转架构到mqtt协议以减少服务器成本, 可支持每万台1台mqtt server即可,需要边缘改动, 共需要 **5天**

  
# 二次图像识别判定服务器端
## 多服务器的负载均衡
### 现状
单服务器GPU.
### 方案
允许多台机器部署

### 计划
* 在边缘数量<=5000台时
  
* 在边缘数量=10000台时 
需要2台GPU服务器  **2天**
  
* 每5000台,增加一台GPU服务器.
  
# WEB端
## 边缘更新程序后端
### 现状
所有边缘都在同一台服务器进行下载
### 方案
CDN
### 计划
工作量 **2天**

## 报警视频
### 现状
所有报警都在同一台服务器去向萤石云进行下载
### 方案
CDN
### 计划
工作量 **1天**

## 整体接口优化
### 现状
与边缘,大屏的接口性能不佳.
### 方案
进行代码优化
### 计划
工作量 **3天**


## 数据库操作相关优化
### 现状
单数据库
### 方案
分库,分表
### 计划
5000 - **2天**
>5000 **3天**

## Web程序负载均衡
### 现状
单服务单进程
### 方案
多服务器负载均衡.
### 计划
5000    2台服务器 - **2天**
>5000   优化+多台服务器 **3天**


# 全局日志服务
## 边缘
## DeviceHub
## ???
### 方案
应用程序适配 **3天**
使用阿里云  **2天**
使用自建  **4天**

# 安卓大屏
## 广告服务连接
### 现状
边到同一台服务器上
### 方案
分片区连接不同资源服务器

## 多硬件平台方案的支持
### 现状
仅支持单一硬件品牌,包括版本管理等.
### 方案
xxxxx

# 服务器集群管理
## 服务器性能监测
## 服务器报警
netdata **2天**
